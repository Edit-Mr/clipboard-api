/** @format */

const filePath =
    "https://api.github.com/repos/Edit-Mr/clipboard-api/contents/clip.txt";
const token = "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";

// Fetch the current file content
let reqGet = new Request(filePath);
reqGet.headers = { Authorization: `token ${token}` };

let currentContent;
try {
    const response = await reqGet.loadJSON();
    currentContent = response;
} catch (error) {
    console.error("Error fetching current content:", error);
}

if (currentContent) {
    const sha = currentContent.sha;
    const newContent =  Pasteboard.pasteString();
    const newContentBase64 = Data.fromString(newContent).toBase64String();
    let reqUpdate = new Request(filePath);
    reqUpdate.method = "PUT";
    reqUpdate.headers = {
        Authorization: `token ${token}`,
        "Content-Type": "application/json",
    };
    reqUpdate.body = JSON.stringify({
        message: "Update file",
        content: newContentBase64,
        sha: sha,
    });
    try {
        const response = await reqUpdate.loadJSON();
        console.log("File updated:", response);
    } catch (error) {
        console.error("Error updating file:", error);
    }
}
